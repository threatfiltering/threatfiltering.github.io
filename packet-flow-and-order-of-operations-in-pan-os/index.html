<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Packet Flow And Order Of Operations in Pan OS | Threat Filtering</title>


<link rel="stylesheet" href="https://threatfiltering.com/css/style.css" />
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9931324042838184"
     crossorigin="anonymous"></script>
</head>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-SBXL4GW9G9"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-SBXL4GW9G9');
</script>
<body>
  <div class="mx-auto w-full max-w-7xl">
    <header class="bg-white">
      


        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
            
                <div class="text-2xl font-bold text-gray-800">
                    <a href="/">
                        <img src="/img/logo.png" width="181" height="92" alt="">
                    </a>
                </div>

                
                <div>
                    <a href="/contact-us/" class="inline-block px-5 py-2 text-gray-700">Contact Us</a>
                </div>
            </div>
        </div>




    </header>
    <main>
      
    

    <div class="grid grid-cols-1 md:grid-cols-3 m3 md:m-12">
        <div id="main-content" class="col-span-2 m-3 text-align-left font-sans text-base/relaxed tracking-wide md:border-r-gray-400 md:border-r-1 md:pr-12">
                <h1 id="packet-flow-and-order-of-operations-in-pan-os">Packet Flow and Order of Operations in PAN-OS</h1>
<p>Order of operations in Palo Alto Networks firewalls consists of 6 stages: <strong>Ingress &gt; Session Setup (Slowpath) &gt; Existing Session (Fastpath) &gt; Application Identification &gt; Content Inspection &gt; Egress Forwarding</strong>. Understanding how traffic is being processed within the firewall is important for writing security and NAT policies and troubleshooting. The following sections provide information about each of the stages.</p>
<p>Logical packet flow within Palo Alto firewall is depicted in the diagram below.</p>
<img src="image-23.png" alt="" class="img-fluid py-4"><h2 id="ingress-stage">Ingress stage</h2>
<p>As a packet enters one of the firewall interfaces it goes through ingress processing. During this stage, frames, packets and Layer 4 datagrams are validated to ensure that there are no network-layer issues, such as incorrect checksums or truncated headers.</p>
<p>Then the source security zone lookup is done based on the incoming interface. If the packet matches an established IPSec or SSL tunnel it is decrypted, in which case zone lookup is done against the tunnel-associated interface.</p>
<h2 id="session-setup-slowpath">Session Setup (Slowpath)</h2>
<blockquote>
<p><strong>What is a flow and a session?</strong></p>
</blockquote>
<p>Flow is group of packets with matching:</p>
<ul>
<li>Source and Destination IP addresses</li>
<li>Protocols</li>
<li>Source and Destination Ports (for UDP/TCP)</li>
<li>Specific Protocol Identifiers (for non-UDP/TCP)</li>
<li>Source Zone</li>
</ul>
<p>A session from the firewall perspective consists of two unidirectional flows:</p>
<ul>
<li>Client-to-server</li>
<li>Return server-to-client</li>
</ul>
<p>In the diagram above, packets 1, 2, 3 are from the same session. A session is created with the first packet which follows slow path. Subsequent packets don’t require lookups performed during session setup and as result they skip this step following fast path.</p>
<blockquote>
<p><strong>How session setup works?</strong></p>
</blockquote>
<p>Session is created after the following steps are performed:</p>
<ul>
<li>Route lookup for forwarding (for Layer 3 interfaces)</li>
<li>MAC table lookup (for Layer 2 interfaces)</li>
<li>Network Address Translation (NAT) lookup</li>
<li>User-ID lookup</li>
<li>Security Policy lookup</li>
</ul>
<p>Consider the example in the following diagram. In this example, the firewall has 3 interfaces each allocated to a zone. There are no routes configured, apart from the default route with the next hop of 1.1.1.1. Service provider has allocated a public IP address range of 100.100.100.0/24.</p>
<img src="image-24.png" alt="" class="img-fluid py-4"><p>Route lookup is based on destination IP address of the packet and MAC table lookup is based on destination MAC address of the frame. Both lookups return information on egress interface. The logic is straightforward if there is no NAT in use. The first packet from the web server to the database server in trusted zone will trigger new session entry. The source interface and zone is known, as the packet is received on E1/2 interface of DMZ zone. The destination interface and zone lookup return directly connected network 10.1.5.0/24, which is reachable over E1/3 interface in Trust zone. Security policy will be looking through rules having DMZ zone as the source and Trust zone as destination.</p>
<p>If there are any NAT policy rules configured on the firewall, then the NAT lookup is performed.</p>
<blockquote>
<p><strong>How NAT policy lookup works in Palo Alto?</strong></p>
</blockquote>
<p>As per diagram above, an administrator wants to configure destination NAT, so users on Internet can connect to a Web server in DMZ with the IP address of 172.16.1.15. As it is private IP address, it has to be mapped to a public IP address (100.100.100.15) from the allocated pool.</p>
<p>NAT policy lookup will be triggered on a first packet coming from the client on Internet. Source interface and zone are E1/1 and Untrust. The destination IP address in the packet is 100.100.100.15 (pre-NAT). Route lookup will return default route pointing to Internet via E1/1. Therefore, source and destination zones are the same – Untrust. Packets in the return flow will be also translated, as they constitute the same session.</p>
<p>However, if this server will initiate a new session to a server on the Internet, the packet will not match the destination NAT entry. Additional source NAT entry is required with Trust as source and Internet as destination zone.</p>
<p>To combine one-to-one destination and source NAT described in previous 2 paragraphs, an administrator can configure static bi-directional source NAT.</p>
<p>With the destination NAT the router performs second interface lookup based on post-NAT address. In this case, this second lookup will return E1/3 and Trust. It will be used for the security policy lookup later, NAT rule still references Untrust as both source and destination zone.</p>
<p>During this stage the packet is not changed. NAT is done later, in the Fastpath stage.</p>
<blockquote>
<p><strong>How security policy lookup works in Palo Alto with NAT?</strong></p>
</blockquote>
<p>If destination NAT is in use – security policy must reference pre-NAT IP addresses, as the system hasn’t modified the packet yet. However, the destination zone is post-NAT, as the second interface and zone is known after NAT policy lookup.</p>
<h2 id="security-policy-processing-fastpath-app-id-and-content-inspection">Security Policy Processing (Fastpath), App-ID and Content Inspection</h2>
<p>The next stages are responsible for application of the security policies. Firewall checks the traffic against Layer 2 to Layer 4 rules. For TCP traffic protocol-based security inspection is also performed. During Fastpath NAT is applied if configured.</p>
<p>Palo Alto firewalls are built using Single-Pass Parallel Processing (SP3) Architecture in which traffic stream is scanned only once by having different firewall features to use the same signature format, so they can be applied simultaneously in parallel. This minimizes delays caused by packet buffering.</p>
<p>Features that are applied in parallel:</p>
<ul>
<li>Application identification</li>
<li>User and group mapping</li>
<li>Content scanning</li>
</ul>
<p>Firewall can recognize the application from traffic flow by using signatures, as opposed to just looking at protocol and port numbers. This feature is called App-ID. User and group mapping allows firewall to use users and groups in policies, instead of IP addresses. Content scanning responsibilities are threat detection, prevention, URL filtering.</p>
<h2 id="egress-forwarding-stage">Egress Forwarding stage</h2>
<p>Finally, the packets are prepared to be sent over the network. During this stage network-related processing is done, such as traffic shaping, IP fragmentation. If the traffic is for VPN, encryption is done during this stage.</p>


                
                <div class="mt-9">
                    
                    
                    <nav class="inline-grid grid-cols-4 space-x-2.5 w-full justify-center pt-5">

                        
                        <a class="text-center col-start-2  py-2 px-3 rounded font-medium select-none border text-gray-900  bg-white transition-colors hover:border-gray-400 hover:bg-gray-700 hover:text-white "
                            href="/palo-alto-firewalls-configuration-management/">
                            &lt; Prev
                        </a>
                        

                        
                        <a class="text-center col-start-3 py-2 px-3 rounded font-medium select-none border text-gray-900  bg-white dtransition-colors hover:border-gray-400 hover:bg-gray-700 hover:text-white "
                            href="/site-to-site-vpns-on-palo-alto-network-firewalls/">
                            Next > </a>
                        
                    </nav>

                </div>
                



        </div>
        
        <div class="mt-6 ml-6">

                <h2 class="mb-5">Categories:</h2>
                <ul class="text-cyan-500">
                    
                        <li class="mb-1"><a href="/category/cisco/">Cisco</a></li>
                    
                        <li class="mb-1"><a href="/category/cisco-asa/">Cisco ASA</a></li>
                    
                        <li class="mb-1"><a href="/category/palo-alto/">Palo Alto</a></li>
                    
                        <li class="mb-1"><a href="/category/pki/">PKI</a></li>
                    
                </ul>
                <br>

                
                <br>
                
                <h2 class="mb-5">Recent posts:</h2>
                <ul class="text-cyan-500">
                    
                        <li><a class="mb-1" href="/cisco-firewall-models-and-performance/">Cisco Firewall Models and Performance</a></li>
                    
                        <li><a class="mb-1" href="/cisco-zone-based-firewall-configuration-step-by-step-part-2/">Cisco Zone Based Firewall Configuration Step By Step Part 2</a></li>
                    
                        <li><a class="mb-1" href="/cisco-zone-based-firewall-configuration-step-by-step-part-1/">Cisco Zone Based Firewall Configuration Step By Step Part 1</a></li>
                    
                        <li><a class="mb-1" href="/install-ssl-certificate-on-palo-alto-networks-or-cisco-asa-firewalls/">Install SSL certificate on Palo Alto Networks or Cisco ASA Firewalls</a></li>
                    
                        <li><a class="mb-1" href="/site-to-site-vpns-on-palo-alto-network-firewalls/">Site-To-Site VPNs on Palo Alto Networks Firewalls</a></li>
                    
                </ul>
            </div>
        </div>



    </div>

    </main>
    <footer class="pt-24 text-center text-sm">
          
            <a href="/privacy-policy" style="text-decoration:none;" class="link-dark">Privacy Policy</a> - 
            <a href="/terms-and-conditions" style="text-decoration:none;" class="link-dark">Terms and Conditions</a></p>
            <p class="text-dark">Copyright &copy; 2025 threatfiltering.net</p>

    </footer>
  </div>
</body>
</html>
